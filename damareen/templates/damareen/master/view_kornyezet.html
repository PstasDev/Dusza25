{% extends 'damareen/base.html' %}

{% block title %}{{ kornyezet.nev }} - Szerkeszt√©s{% endblock %}

{% block content %}
<h2>‚öôÔ∏è {{ kornyezet.nev }}</h2>

<div class="card">
    <h3>üìö Kezd≈ë gy≈±jtem√©ny be√°ll√≠t√°sa</h3>
    
    <p>V√°laszd ki, hogy mely k√°rty√°k legyenek a j√°t√©kosok kezd≈ë gy≈±jtem√©ny√©ben:</p>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="grid" style="margin-top: 20px;">
            {% for kartya in vilag_kartyak %}
            <div class="card">
                <label style="cursor: pointer; display: block;">
                    <input type="checkbox" name="kartyak" value="{{ kartya.id }}"
                           {% for gyujtemeny_kartya in kezdo_gyujtemeny %}
                               {% if gyujtemeny_kartya.kartya.id == kartya.id %}checked{% endif %}
                           {% endfor %}
                           style="margin-right: 10px;">
                    
                    <div class="kartya kartya-{{ kartya.tipus }}" style="margin-top: 10px;">
                        <h4>{{ kartya.nev }}</h4>
                        <div class="kartya-stat">
                            <span>‚öîÔ∏è Sebz√©s:</span>
                            <span>{{ kartya.sebzes }}</span>
                        </div>
                        <div class="kartya-stat">
                            <span>‚ù§Ô∏è √âleter≈ë:</span>
                            <span>{{ kartya.eletero }}</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="elem-icon elem-{{ kartya.tipus }}">
                                {{ kartya.get_tipus_display }}
                            </span>
                        </div>
                    </div>
                </label>
            </div>
            {% endfor %}
        </div>
        
        <div style="margin-top: 30px;">
            <button type="submit" class="btn btn-success">
                ‚úÖ Gy≈±jtem√©ny ment√©se
            </button>
        </div>
    </form>
</div>

<div class="card" style="margin-top: 30px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">üè∞ El√©rhet≈ë kazamat√°k</h3>
        <a href="{% url 'damareen:manage_kazamatak' %}" class="btn btn-primary">
            ‚öôÔ∏è Kazamat√°k kezel√©se
        </a>
    </div>
    
    <p style="color: #cbd5e0; margin-bottom: 20px; font-size: 14px;">
        Itt l√°thatod az √∂sszes el√©rhet≈ë kazamat√°t. A kazamat√°k kezel√©se gombbal tudsz √∫jakat l√©trehozni, szerkeszteni vagy t√∂r√∂lni.
    </p>
    
    {% if kazamatak %}
        {% for kazamata in kazamatak %}
        <div style="background: rgba(26, 26, 46, 0.6); padding: 20px; border-radius: 12px; margin: 15px 0; border-left: 4px solid 
            {% if kazamata.tipus == 'egyszeru' %}#9b59b6
            {% elif kazamata.tipus == 'kis' %}#3498db
            {% else %}#e74c3c{% endif %};">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0; color: 
                    {% if kazamata.tipus == 'egyszeru' %}#9b59b6
                    {% elif kazamata.tipus == 'kis' %}#3498db
                    {% else %}#e74c3c{% endif %};">
                    üè∞ {{ kazamata.nev }}
                </h4>
                <span style="background: linear-gradient(135deg, 
                    {% if kazamata.tipus == 'egyszeru' %}#9b59b6 0%, #8e44ad 100%
                    {% elif kazamata.tipus == 'kis' %}#3498db 0%, #2980b9 100%
                    {% else %}#e74c3c 0%, #c0392b 100%{% endif %}); 
                    color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold;">
                    {{ kazamata.get_tipus_display }}
                </span>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; padding: 12px; background: rgba(218, 165, 32, 0.1); border-radius: 8px;">
                <div style="text-align: center;">
                    <div style="color: #64748b; font-size: 11px;">K√°rty√°k</div>
                    <div style="color: #daa520; font-weight: bold;">{{ kazamata.kartyak.count }}</div>
                </div>
                <div style="text-align: center;">
                    <div style="color: #64748b; font-size: 11px;">Kapacit√°s</div>
                    <div style="color: #cbd5e0; font-weight: bold;">{{ kazamata.get_kartyak_szama }}</div>
                </div>
                <div style="text-align: center;">
                    <div style="color: #64748b; font-size: 11px;">Jutalom</div>
                    <div style="color: #10b981; font-weight: bold; font-size: 13px;">{{ kazamata.get_nyeremeny_leiras }}</div>
                </div>
            </div>
            
            {% if kazamata.kartyak.exists %}
                <div style="margin-top: 15px;">
                    <h5 style="color: #daa520; margin-bottom: 10px; font-size: 14px;">üÉè K√°rty√°k sorrendben:</h5>
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        {% for kk in kazamata.kartyak.all %}
                        <div style="background: rgba(26, 26, 46, 0.8); padding: 8px 12px; border-radius: 6px; border-left: 3px solid 
                            {% if kk.kartya.tipus == 'tuz' %}#ff4757
                            {% elif kk.kartya.tipus == 'fold' %}#8b4513
                            {% elif kk.kartya.tipus == 'viz' %}#3498db
                            {% else %}#1dd1a1{% endif %}; display: flex; justify-content: space-between; align-items: center;">
                            
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: rgba(218, 165, 32, 0.3); color: #daa520; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold;">
                                    #{{ kk.sorrend }}
                                </span>
                                <span style="font-weight: bold; color: 
                                    {% if kk.kartya.tipus == 'tuz' %}#ff4757
                                    {% elif kk.kartya.tipus == 'fold' %}#8b4513
                                    {% elif kk.kartya.tipus == 'viz' %}#3498db
                                    {% else %}#1dd1a1{% endif %};">
                                    {{ kk.kartya.nev }}
                                </span>
                                {% if kk.is_vezer %}
                                    <span style="color: #daa520; font-size: 14px;" title="Vez√©rk√°rtya">üëë</span>
                                {% endif %}
                            </div>
                            <div style="font-size: 12px; color: #94a3b8;">
                                <span title="Sebz√©s">‚öîÔ∏è {{ kk.kartya.sebzes }}</span>
                                <span style="margin-left: 10px;" title="√âleter≈ë">‚ù§Ô∏è {{ kk.kartya.eletero }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <p style="color: #64748b; font-style: italic; text-align: center; margin: 10px 0; font-size: 13px;">
                    üÉè A kazamata m√©g √ºres (nincsenek k√°rty√°k)
                </p>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div style="background: rgba(100, 116, 139, 0.2); padding: 40px; border-radius: 8px; text-align: center;">
            <p style="color: #64748b; font-size: 16px; margin-bottom: 15px;">
                üè∞ M√©g nincsenek kazamat√°k az adatb√°zisban.
            </p>
            <a href="{% url 'damareen:manage_kazamatak' %}" class="btn btn-primary">
                ‚ûï Hozd l√©tre az els≈ë kazamat√°t!
            </a>
        </div>
    {% endif %}
</div>

<div style="margin-top: 30px;">
    <a href="{% url 'damareen:master_dashboard' %}" class="btn btn-secondary">
        ‚¨ÖÔ∏è Vissza a f≈ëoldalra
    </a>
</div>
{% endblock %}
